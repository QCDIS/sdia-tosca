tosca_definitions_version: "tosca_simple_yaml_1_0"
topology_template:
  node_templates:
    compute:
      properties:
        disk_size: "10000 MB"
        mem_size: "1000 MB"
        num_cores: 1.0
        os_distro: Ubuntu
        os_version: 18.04
        user_name: "vm_user"
      interfaces:
        Standard:
          create: "dumy.yaml"
      type: "tosca.nodes.QC.VM.Compute"
      attributes:
        user_key_pair:
          protocol: "ssh"
          keys:
            public_key: "XXXXXX=="
            private_key: "XXXXXX=="
        public_ip: "192.168.1.12"
        role: "master"
        node_type: "t2.micro"
        host_name: "vm0"
    compute_1:
      properties:
        disk_size: "10000 MB"
        mem_size: "1000 MB"
        num_cores: 1.0
        os_distro: Ubuntu
        os_version: 18.04
        user_name: "vm_user"
      interfaces:
        Standard:
          create: "dumy.yaml"
      type: "tosca.nodes.QC.VM.Compute"
      attributes:
        user_key_pair:
          protocol: "ssh"
          keys:
            public_key: "XXXXXX"
            private_key: "XXXXXX"
        public_ip: "192.168.1.10"
        role: "worker"
        node_type: "t2.micro"
        host_name: "vm1"
    kubernetes:
      requirements:
      - host:
          capability: "tosca.capabilities.QC.VM.topology"
          node: "topology"
          relationship: "tosca.relationships.HostedOn"
      interfaces:
        Standard:
          configure:
            inputs:
              repository: "https://github.com/QCDIS/playbooks.git"
              resources:
              - "k8s/set_master_k8s_cluster.yaml"
              - "k8s/join_k8s_cluster.yaml"
              - "k8s/create_k8s_metrics_server.yaml"
              - "k8s/create_k8s_dashboard.yaml"
              - "k8s/get_config.yaml"
          create:
            inputs:
              repository: "https://github.com/QCDIS/playbooks.git"
              resources:
              - "ec2/ec2_mount.yaml"
              - "docker/install_docker.yaml"
              - "k8s/install_k8s_prerequisites.yaml"
              - "k8s/install_k8s.yaml"
          delete:
            inputs:
              repository: "https://github.com/QCDIS/playbooks.git"
              resources:
              - "k8s/k8s_delete.yaml"
      type: "tosca.nodes.QC.docker.Orchestrator.Kubernetes"
    topology:
      properties:
        domain: "Ireland"
        provider: "Azure"
      requirements:
      - vm:
          capability: "tosca.capabilities.QC.VM"
          node: "compute"
          relationship: "tosca.relationships.DependsOn"
      - vm:
          capability: "tosca.capabilities.QC.VM"
          node: "compute_1"
          relationship: "tosca.relationships.DependsOn"
      interfaces:
        CloudsStorm:
          delete:
            inputs:
              code_type: "SEQ"
              object_type: "SubTopology"
          hscale:
            inputs:
              code_type: "SEQ"
              object_type: "SubTopology"
          provision:
            inputs:
              code_type: "SEQ"
              object_type: "SubTopology"
          start:
            inputs:
              code_type: "SEQ"
              object_type: "SubTopology"
          stop:
            inputs:
              code_type: "SEQ"
              object_type: "SubTopology"
      type: "tosca.nodes.QC.VM.topology"
      attributes:
        credential:
          cloud_provider_name: "Azure"
          keys:
            aws_access_key_id: "XXXXXXXXXXXXXXXXX"
          token: "XXXXXXXXXXXXXXXXx"
          token_type: "access_key"
        desired_state: "RUNNING"
        current_state: "RUNNING"
description: "k8s topology for deploying FAIR-Cells containers"
imports:
- nodes: "file:///home/alogo/workspace/sdia-tosca/types/nodes.yaml"
- data: "file:///home/alogo/workspace/sdia-tosca/types/data.yml"
- capabilities: "file:///home/alogo/workspace/sdia-tosca/types/capabilities.yaml"
- policies: "file:///home/alogo/workspace/sdia-tosca/types/policies.yaml"
- interfaces: "file:///home/alogo/workspace/sdia-tosca/types/interfaces.yml"
