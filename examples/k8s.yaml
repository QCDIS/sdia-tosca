tosca_definitions_version: tosca_simple_yaml_1_0

imports:
  - nodes: https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/nodes.yaml
  - data: https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/data.yml
  - capabilities: https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/capabilities.yaml
  - policies: https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/policies.yaml
  - interfaces: https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/interfaces.yml
  
repositories:
  docker_hub: https://hub.docker.com/  

description: >
  TOSCA example
  

topology_template:

  node_templates:
    compute:
      properties:
        disk_size: "40000 MB"
        mem_size: "4000 MB"
        num_cores: 2
        os_distro: "Ubuntu"
        os_version: "18.04"
        user_name: "vm_user"
      interfaces:
        Standard:
          create: "dumy.yaml"
      type: "tosca.nodes.QC.VM.Compute"
    compute_1:
      properties:
        disk_size: "40000 MB"
        mem_size: "4000 MB"
        num_cores: 2
        os_distro: "Ubuntu"
        os_version: "18.04"
        user_name: "vm_user"
      interfaces:
        Standard:
          create: "dumy.yaml"
      type: "tosca.nodes.QC.VM.Compute"
    topology:
      properties:
        domain: "Ireland"
        provider: "EC2"
      requirements:
      - vm:
          capability: "tosca.capabilities.QC.VM"
          node: "compute"
          relationship: "tosca.relationships.DependsOn"
      - vm:
          capability: "tosca.capabilities.QC.VM"
          node: "compute_1"
          relationship: "tosca.relationships.DependsOn"
      type: "tosca.nodes.QC.VM.topology"
    kubernetes:
      requirements:
        - host:
            capability: "tosca.capabilities.QC.VM.topology"
            node: "topology"
            relationship: "tosca.relationships.HostedOn"
      interfaces:
        Standard:
          configure:
            inputs:
              repository: "https://github.com/QCDIS/playbooks.git"
              resources:
                - "k8s/set_master_k8s_cluster.yaml"
                - "k8s/join_k8s_cluster.yaml"
                - "k8s/create_k8s_metrics_server.yaml"
                - "k8s/create_k8s_dashboard.yaml"
                - "k8s/get_config.yaml"
          create:
            inputs:
              repository: "https://github.com/QCDIS/playbooks.git"
              resources:
                - "ec2/ec2_mount.yaml"
                - "docker/install_docker.yaml"
                - "k8s/install_k8s_prerequisites.yaml"
                - "k8s/install_k8s.yaml"
          delete:
            inputs:
              repository: "https://github.com/QCDIS/playbooks.git"
              resources:
                - "k8s/k8s_delete.yaml"
      type: "tosca.nodes.QC.docker.Orchestrator.Kubernetes"
