tosca_definitions_version: "tosca_simple_yaml_1_0"
topology_template:
  node_templates:
    compute:
      properties:
        disk_size: "10000 MB"
        mem_size: "1000 MB"
        num_cores: 1
        os: "Ubuntu 18.04"
        user_name: "vm_user"
      interfaces:
        Standard:
          create: "dumy.yaml"
      type: "tosca.nodes.QC.VM.Compute"
    topology:
      type: tosca.nodes.QC.VM.topology
      properties:
        domain: "Spain"
        provider: "CESGA"
      requirements:
      - vm:
          capability: "tosca.capabilities.QC.VM"
          node: "compute"
          relationship: "tosca.relationships.DependsOn"
      interfaces:
#        CloudsStorm:
#          delete:
#            inputs:
#              code_type: "SEQ"
#              object_type: "SubTopology"
#          hscale:
#            inputs:
#              code_type: "SEQ"
#              object_type: "SubTopology"
#          provision:
#            inputs:
#              code_type: "SEQ"
#              object_type: "SubTopology"
#          start:
#            inputs:
#              code_type: "SEQ"
#              object_type: "SubTopology"
#          stop:
#            inputs:
#              code_type: "SEQ"
#              object_type: "SubTopology"
        Openstack:
#          type: tosca.interfaces.QC.Openstack
#          inputs:
#            os_auth_url: "https://stack-server.ct.infn.it:35357/v3"
#            os_project_id: "745695ccd17042fabf96d2410a4278d9"
#            os_auth_type: "v3oidcaccesstoken"
#            os_identity_provider: "egi.eu"
#            os_protocol: "openid"
          create:
            inputs:
              os_auth_url: "https://stack-server.ct.infn.it:35357/v3"
              os_project_id: "745695ccd17042fabf96d2410a4278d9"
              os_auth_type: "v3oidcaccesstoken"
              os_identity_provider: "egi.eu"
              os_protocol: "openid"
              repository: https://github.com/QCDIS/playbooks.git
              resources:
                - openstack/install_requirements.yaml
                - openstack/info/get_images.yaml
                - openstack/info/get_inst_flavors.yaml
                - openstack/info/get_networks.yaml
                - openstack/key/create_key.yaml
                - openstack/server/create_vm.yaml
          configure:
            inputs:
              os_auth_url: "https://stack-server.ct.infn.it:35357/v3"
              os_project_id: "745695ccd17042fabf96d2410a4278d9"
              os_auth_type: "v3oidcaccesstoken"
              os_identity_provider: "egi.eu"
              os_protocol: "openid"
              repository: "https://github.com/QCDIS/playbooks.git"
              resources:
                - create_user.yaml
                - create_user_key_pair

description: "TOSCA example"
imports:
- nodes: "https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/nodes.yaml"
- data: "https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/data.yml"
- capabilities: "https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/capabilities.yaml"
- policies: "https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/policies.yaml"
- interfaces: "https://raw.githubusercontent.com/qcdis-sdia/sdia-tosca/master/types/interfaces.yml"
